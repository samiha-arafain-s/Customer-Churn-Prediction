{% extends "base.html" %}
{% block content %}
<div class="row align-items-center mb-4">
  <div class="col-md-7">
    <h1 class="fw-bold">Customer Churn Prediction</h1>
    <p class="lead">Upload the Telco Customer Churn dataset, train ML models (Logistic Regression & Random Forest), and predict churn for single customers or entire CSV files.</p>
    <div class="d-flex gap-2 flex-wrap">
      <a class="btn btn-primary" href="{{ url_for('upload') }}">ğŸ“¤ Upload Dataset</a>
      <a class="btn btn-success" href="{{ url_for('train_route') }}">ğŸ¤– Train Models</a>
      <a class="btn btn-outline-primary" href="{{ url_for('predict_route') }}">ğŸ”® Predict Churn</a>
    </div>
  </div>
  <div class="col-md-5">
    <div class="card shadow-sm">
      <div class="card-body">
        <h5 class="card-title">ğŸ“Š Dataset Snapshot</h5>
        <div class="d-flex justify-content-between">
          <div class="text-center">
            <span class="text-muted small d-block">ğŸ‘¥ Total</span>
            <div class="h4 mb-0 text-primary fw-bold">{{ stats.total }}</div>
          </div>
          <div class="text-center">
            <span class="text-muted small d-block">âš ï¸ Churned</span>
            <div class="h4 mb-0 text-danger fw-bold">{{ stats.churned }}</div>
          </div>
          <div class="text-center">
            <span class="text-muted small d-block">ğŸ“ˆ Churn %</span>
            <div class="h4 mb-0 text-warning fw-bold">{{ stats.churn_pct }}%</div>
          </div>
        </div>
        <hr>
        <p class="mb-1 small text-muted">Last trained model</p>
        {% if last_metric %}
          <div class="d-flex justify-content-between align-items-center">
            <strong>{{ last_metric.model_type }}</strong>
            <span class="badge bg-success">Accuracy: {{ '%.2f'|format(last_metric.accuracy * 100) }}%</span>
          </div>
          <div class="small text-muted mt-1">Trained at {{ last_metric.trained_at }}</div>
        {% else %}
          <div class="text-muted">No model trained yet.</div>
        {% endif %}
        <div class="mt-3">
          {% if model_exists %}
            <span class="badge bg-primary">âœ… Model saved</span>
          {% else %}
            <span class="badge bg-warning">âš ï¸ Train to create model</span>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>

<div class="row g-3">
  <div class="col-md-4">
    <div class="card h-100 shadow-sm border-top border-primary border-4">
      <div class="card-body">
        <h5 class="card-title">ğŸ“¤ 1) Upload CSV</h5>
        <p class="card-text">Use the Telco Customer Churn CSV with a <code>Churn</code> column (Yes/No). Missing values are handled automatically.</p>
        <a href="{{ url_for('upload') }}" class="btn btn-sm btn-outline-primary mt-2">Go to Upload â†’</a>
      </div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="card h-100 shadow-sm border-top border-success border-4">
      <div class="card-body">
        <h5 class="card-title">ğŸ¤– 2) Train Models</h5>
        <p class="card-text">Trains Logistic Regression & Random Forest, compares accuracy, and saves the best pipeline with preprocessing.</p>
        <a href="{{ url_for('train_route') }}" class="btn btn-sm btn-outline-success mt-2">Go to Train â†’</a>
      </div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="card h-100 shadow-sm border-top border-info border-4">
      <div class="card-body">
        <h5 class="card-title">ğŸ”® 3) Predict Churn</h5>
        <p class="card-text">Predict for a single customer through a form or upload a CSV for bulk predictions and download results.</p>
        <a href="{{ url_for('predict_route') }}" class="btn btn-sm btn-outline-info mt-2">Go to Predict â†’</a>
      </div>
    </div>
  </div>
</div>
{% endblock %}

